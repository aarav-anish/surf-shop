<%- include('../partials/header') -%>

<div>
  <h1>Edit your post</h1>
  <form
    action="/post/<%= post._id %>?_method=PUT"
    method="POST"
    enctype="multipart/form-data"
    id="postEditForm"
  >
    <div class="form-group">
      <label> Title </label>
      <input
        class="form-control"
        type="text"
        placeholder="title"
        name="title"
        value="<%= post.title %>"
      />
      <label> Description </label>
      <textarea class="form-control" name="description" cols="30" rows="10">
<%= post.description %></textarea
      >
      <label> Images </label>
      <input
        class="form-control imageUploads"
        type="file"
        accept="images/*"
        name="images"
        multiple
      />
      <div>
        <% post.images.forEach((image) => { %>
        <img src="<%= image.url %> " alt="surf-image" width="200px" />
        <input name="deleteImage" type="checkbox" class="imagesDeleteCheckbox" />
        <label> Delete ? </label>
        <% }) %>
      </div>
      <label> Price </label>
      <input
        class="form-control"
        type="text"
        placeholder="price"
        name="price"
        value="<%= post.price %>"
      />
      <label> Location </label>
      <input
        class="form-control"
        type="text"
        placeholder="location"
        name="location"
        value="<%= post.location %>"
      />
      <button class="btn btn-primary" type="submit" name="edit">Edit</button>
    </div>
  </form>
</div>

<script>
  let postEditForm = document.getElementById('postEditForm');

  postEditForm.addEventListener('submit', (event) => {
    // find number of image uploads
    let imageUploads = document.querySelector('.imageUploads').files.length;

    // find number of  existing images
    let existingImages = document.querySelectorAll(
      '.imagesDeleteCheckbox',
    ).length;

    // find number of deletions
    let imageDeletions = document.querySelectorAll(
      '.imagesDeleteCheckbox:checked',
    ).length;

    let newTotal = existingImages + imageUploads - imageDeletions;
    if (newTotal > 4) {
      event.preventDefault();

      console.log(existingImages, imageUploads, imageDeletions);
      alert(
        `You need to delete at least ${newTotal - 4} image${
          newTotal === 5 ? '' : 's'
        }`,
      );
    }
  });
</script>

<%- include('../partials/footer') -%>
